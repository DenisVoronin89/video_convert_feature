2025-01-05 18:30:31,953 - INFO - Запуск приложения и инициализация базы данных...
2025-01-05 18:30:31,953 - DEBUG - Начало инициализации базы данных...
2025-01-05 18:30:32,079 - INFO - База данных успешно инициализирована.
2025-01-05 18:30:32,081 - INFO - Приложение успешно запущено. Соединение с базой данных установлено.
2025-01-05 18:30:32,082 - INFO - Директория уже существует: ./video_temp
2025-01-05 18:30:32,083 - INFO - Директория уже существует: ./image_temp
2025-01-05 18:30:32,083 - INFO - Директория уже существует: ./output_video
2025-01-05 18:30:32,084 - INFO - Директория уже существует: ./output_preview
2025-01-05 18:30:32,084 - INFO - Директория уже существует: ./user_logo
2025-01-05 18:30:32,188 - INFO - Запуск подписки на канал Redis для получения задач
2025-01-05 18:30:32,193 - INFO - Redis доступен.
2025-01-05 18:30:32,193 - INFO - Подключаемся к Redis...
2025-01-05 18:30:32,193 - INFO - Подписались на канал video_tasks
2025-01-05 18:30:47,885 - INFO - Получен запрос на загрузку изображения.
2025-01-05 18:30:47,892 - INFO - Изображение сохранено во временной директории: ./image_temp/d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp (Размер: 0.07 MB)
2025-01-05 18:30:47,892 - INFO - Изображение успешно загружено: ./image_temp/d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp
2025-01-05 18:31:20,906 - INFO - Получен запрос на загрузку видео.
2025-01-05 18:31:20,914 - INFO - видео сохранено во временной директории: ./video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 (Размер: 2.35 MB)
2025-01-05 18:31:20,914 - INFO - Видео успешно загружено: ./video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4
2025-01-05 18:31:51,594 - INFO - Получены данные профиля: {'name': 'John Doe', 'url': 'https://example.com/', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': '#gaming #traveling', 'is_incognito': False, 'wallet_number': '0x123456789ABCDEF', 'adress': '123 Example Street, Example City', 'coordinates': [37.7749, -122.4194]}
2025-01-05 18:31:51,595 - INFO - Получены данные о изображении: {'image_path': './image_temp/d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp'}
2025-01-05 18:31:51,595 - INFO - Получены данные о видео: {'video_path': './video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4'}
2025-01-05 18:31:51,598 - INFO - Номер кошелька захэширован: 8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e
2025-01-05 18:31:51,598 - INFO - Путь к изображению: ./image_temp/d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp
2025-01-05 18:31:51,598 - INFO - Путь к видео: ./video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4
2025-01-05 18:31:51,599 - INFO - Абсолютный путь к изображению: /app/image_temp/d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp
2025-01-05 18:31:51,599 - INFO - Абсолютный путь к видео: /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4
2025-01-05 18:31:51,605 - INFO - Изображение перемещено в директорию user_logo: ./user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp (Размер: 0.07 MB)
2025-01-05 18:31:51,605 - INFO - Путь к файлу для сохранения в БД: ./user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp
2025-01-05 18:31:51,605 - INFO - Изображение успешно перемещено в постоянную папку: ./user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp
2025-01-05 18:31:51,605 - INFO - Обработка данных профиля...
2025-01-05 18:31:51,606 - INFO - Соединение с Redis установлено.
2025-01-05 18:31:51,606 - INFO - Публикуемые данные в Redis: {input_path: /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4, output_path: {'path': './output_video', 'status': 'exists'}, preview_path: {'path': './output_preview', 'status': 'exists'}, user_logo_url: ./user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp, wallet_number: 8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e, form_data: {'name': 'John Doe', 'url': 'https://example.com/', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': '#gaming #traveling', 'is_incognito': False, 'wallet_number': '0x123456789ABCDEF', 'adress': '123 Example Street, Example City', 'coordinates': [37.7749, -122.4194]}}
2025-01-05 18:31:51,614 - INFO - Задача успешно отправлена в канал video_tasks: {'input_path': '/app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4', 'output_path': {'path': './output_video', 'status': 'exists'}, 'preview_path': {'path': './output_preview', 'status': 'exists'}, 'form_data': {'name': 'John Doe', 'url': 'https://example.com/', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': '#gaming #traveling', 'is_incognito': False, 'wallet_number': '0x123456789ABCDEF', 'adress': '123 Example Street, Example City', 'coordinates': [37.7749, -122.4194]}, 'wallet_number': '8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e', 'user_logo_url': './user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp'}
2025-01-05 18:31:51,614 - INFO - Задача успешно отправлена в Redis.
2025-01-05 18:31:51,621 - INFO - Получено сообщение от Redis: {'type': 'message', 'pattern': None, 'channel': 'video_tasks', 'data': '{"input_path": "/app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4", "output_path": {"path": "./output_video", "status": "exists"}, "preview_path": {"path": "./output_preview", "status": "exists"}, "form_data": {"name": "John Doe", "url": "https://example.com/", "activity_hobbies": "Gaming, Traveling", "hashtags": "#gaming #traveling", "is_incognito": false, "wallet_number": "0x123456789ABCDEF", "adress": "123 Example Street, Example City", "coordinates": [37.7749, -122.4194]}, "wallet_number": "8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e", "user_logo_url": "./user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp"}'}
2025-01-05 18:31:51,622 - INFO - Получена задача для обработки: {'input_path': '/app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4', 'output_path': {'path': './output_video', 'status': 'exists'}, 'preview_path': {'path': './output_preview', 'status': 'exists'}, 'form_data': {'name': 'John Doe', 'url': 'https://example.com/', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': '#gaming #traveling', 'is_incognito': False, 'wallet_number': '0x123456789ABCDEF', 'adress': '123 Example Street, Example City', 'coordinates': [37.7749, -122.4194]}, 'wallet_number': '8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e', 'user_logo_url': './user_logo/39db1657-4059-442d-b7c8-2d5ffcc10c98_d8f3c6ae-dc82-4bd6-a32b-a9595ec6460c_orig_cat.webp'}
2025-01-05 18:31:51,622 - INFO - Начинаю конвертацию видео /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 в VP9
2025-01-05 18:31:51,623 - INFO - Запуск конвертации видео в VP9: /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 -> ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm
2025-01-05 18:32:39,620 - INFO - Конвертация в VP9 завершена: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm (Размер: 2.79 MB, Время: 48.00 сек.)
2025-01-05 18:32:39,621 - INFO - Видео успешно обработано: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm (Размер: 2.79 MB)
2025-01-05 18:32:39,621 - INFO - Путь к конвертированному видео: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm
2025-01-05 18:32:39,621 - INFO - Задача конвертации для /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 завершена успешно
2025-01-05 18:32:39,621 - INFO - Начинаю извлечение превью для /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4
2025-01-05 18:32:39,621 - INFO - Извлечение превью из видео: /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 -> ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm (Длительность: 5 сек.)
2025-01-05 18:32:45,885 - INFO - Извлечение превью завершено: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm (Размер: 0.33 MB, Время: 6.26 сек.)
2025-01-05 18:32:45,885 - INFO - Превью успешно извлечено: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm (Размер: 0.33 MB)
2025-01-05 18:32:45,885 - INFO - Путь к извлеченному превью: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm
2025-01-05 18:32:45,885 - INFO - Извлечение превью для /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 завершено успешно
2025-01-05 18:32:45,885 - INFO - Начинаю загрузку видео {'path': './output_video', 'status': 'exists'} и превью {'path': './output_preview', 'status': 'exists'} в S3
2025-01-05 18:32:46,034 - INFO - Соединение с MinIO установлено успешно.
2025-01-05 18:32:46,061 - INFO - Загрузка видео в S3: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm -> f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm
2025-01-05 18:32:46,097 - INFO - Видео успешно загружено в S3: f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm
2025-01-05 18:32:46,097 - INFO - Загрузка превью в S3: ./f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm -> f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm
2025-01-05 18:32:46,102 - INFO - Превью успешно загружено в S3: f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm
2025-01-05 18:32:46,103 - INFO - Загруженные файлы: Видео - http://minio:9000/video-service/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm, Превью - http://minio:9000/video-service/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm
2025-01-05 18:32:46,103 - INFO - Загрузка видео {'path': './output_video', 'status': 'exists'} в S3 завершена успешно. URL: http://minio:9000/video-service/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_converted.webm
2025-01-05 18:32:46,103 - INFO - Загрузка превью {'path': './output_preview', 'status': 'exists'} в S3 завершена успешно. URL: http://minio:9000/video-service/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4_preview.webm
2025-01-05 18:32:46,103 - INFO - Начинаю сохранение профиля в БД для пользователя John Doe
2025-01-05 18:32:46,103 - INFO - Открытие сессии с БД...
2025-01-05 18:32:46,104 - INFO - Сессия с БД успешно открыта.
2025-01-05 18:32:46,155 - INFO - Создана новая запись для кошелька 8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e
2025-01-05 18:32:46,189 - INFO - Видео, пользователь, логотип и хэштеги успешно сохранены для кошелька 8f61a21bdeb89a36bd4679811e0eff2958d18834f363fedeadf79e711b9d7d8e
2025-01-05 18:32:46,190 - INFO - Закрытие сессии с БД.
2025-01-05 18:32:46,191 - INFO - Профиль с именем John Doe успешно сохранен в БД
2025-01-05 18:32:46,191 - INFO - Весь цикл задач для /app/video_temp/f0ef4cd2-bfcb-401a-8726-c76e11b3ba89_ptichka.mp4 выполнен успешно!
2025-01-05 18:32:46,191 - INFO - Данные задачи очищены.
2025-01-05 18:35:14,298 - INFO - Приложение завершило работу. Соединение с базой данных закрыто.
