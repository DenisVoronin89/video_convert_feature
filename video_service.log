2025-03-11 18:59:34,545 - INFO - Запуск подписки на канал Redis для получения задач
2025-03-11 18:59:34,559 - INFO - Redis доступен.
2025-03-11 18:59:34,559 - INFO - Проверка соединения с AWS S3...
2025-03-11 18:59:34,585 - INFO - Запуск приложения и инициализация базы данных...
2025-03-11 18:59:34,586 - DEBUG - Начало инициализации базы данных...
2025-03-11 18:59:34,669 - INFO - База данных успешно инициализирована.
2025-03-11 18:59:34,669 - INFO - Приложение успешно запущено. Соединение с базой данных установлено.
2025-03-11 18:59:34,670 - INFO - Директория уже существует: ./video_temp
2025-03-11 18:59:34,670 - INFO - Директория уже существует: ./image_temp
2025-03-11 18:59:34,670 - INFO - Директория уже существует: ./output_video
2025-03-11 18:59:34,670 - INFO - Директория уже существует: ./output_preview
2025-03-11 18:59:34,670 - INFO - Директория уже существует: ./user_logo
2025-03-11 18:59:34,672 - INFO - Задача fetch_and_cache_profiles добавлена в расписание (каждые 8 минут).
2025-03-11 18:59:34,672 - INFO - Задача sync_data_to_db добавлена в расписание (каждые 8 минут).
2025-03-11 18:59:34,672 - INFO - Задача очистки логов добавлена в расписание (каждые 5 минут).
2025-03-11 18:59:34,672 - INFO - Задача очистки временных файлов добавлена в расписание (каждый день в 00:00).
2025-03-11 18:59:34,673 - INFO - Планировщик задач успешно запущен.
2025-03-11 18:59:35,053 - INFO - Соединение с AWS S3 установлено успешно.
2025-03-11 18:59:35,053 - INFO - Соединение с AWS S3 установлено успешно.
2025-03-11 18:59:35,054 - INFO - Подключаемся к Redis...
2025-03-11 18:59:35,054 - INFO - Подписались на канал video_tasks
2025-03-11 18:59:58,028 - INFO - Открытие сессии с БД...
2025-03-11 18:59:58,037 - INFO - Сессия с БД успешно открыта.
2025-03-11 18:59:58,089 - INFO - Поиск пользователя в базе данных.
2025-03-11 18:59:58,128 - INFO - Пользователь не найден, создаем нового.
2025-03-11 18:59:58,173 - INFO - Создан новый пользователь с ID 942
2025-03-11 18:59:58,173 - INFO - Генерация токенов для пользователя.
2025-03-11 18:59:58,174 - INFO - Токены успешно сгенерированы.
2025-03-11 18:59:58,175 - INFO - Закрытие сессии с БД.
2025-03-11 19:00:35,465 - INFO - Открытие сессии с БД...
2025-03-11 19:00:35,467 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:00:35,622 - INFO - Права администратора успешно выданы для кошелька: 0x27b0B8cfa07fA60f36Ad953F679D36EBC7d4355
2025-03-11 19:00:35,622 - INFO - Закрытие сессии с БД.
2025-03-11 19:00:56,984 - INFO - Открытие сессии с БД...
2025-03-11 19:00:56,988 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:00:57,007 - INFO - Права администратора успешно выданы для кошелька: 0x27b0B8cfa07fA72f36Ad953F679D36EBC7d4355
2025-03-11 19:00:57,007 - INFO - Закрытие сессии с БД.
2025-03-11 19:01:13,286 - INFO - Открытие сессии с БД...
2025-03-11 19:01:13,294 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:01:13,297 - INFO - Поиск пользователя в базе данных.
2025-03-11 19:01:13,309 - INFO - Пользователь найден с ID 941
2025-03-11 19:01:13,380 - INFO - Получение избранного через get_favorites_from_cache.
2025-03-11 19:01:13,381 - INFO - Попытка получить избранное из кэша Redis для пользователя 941.
2025-03-11 19:01:13,421 - INFO - Избранное не найдено в кэше для пользователя 941. Загружаем из базы данных.
2025-03-11 19:01:13,421 - INFO - Открытие сессии с БД...
2025-03-11 19:01:13,421 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:01:13,489 - INFO - У пользователя 941 нет избранных профилей.
2025-03-11 19:01:13,490 - INFO - Закрытие сессии с БД.
2025-03-11 19:01:13,490 - INFO - Избранное получено: []
2025-03-11 19:01:13,490 - INFO - Генерация токенов для пользователя.
2025-03-11 19:01:13,491 - INFO - Токены успешно сгенерированы.
2025-03-11 19:01:13,492 - INFO - Закрытие сессии с БД.
2025-03-11 19:01:52,214 - INFO - Открытие сессии с БД...
2025-03-11 19:01:52,220 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:01:52,300 - WARNING - Пользователь 942 не является администратором.
2025-03-11 19:01:52,301 - ERROR - Ошибка в контексте сессии: 403: Только администраторы могут запрашивать профили для модерации.
2025-03-11 19:01:52,301 - INFO - Закрытие сессии с БД.
2025-03-11 19:04:09,392 - INFO - Открытие сессии с БД...
2025-03-11 19:04:09,395 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:04:09,497 - INFO - Получено 50 профилей для модерации, страница 1
2025-03-11 19:04:09,497 - INFO - Закрытие сессии с БД.
2025-03-11 19:04:34,684 - INFO - Открытие сессии с БД...
2025-03-11 19:04:34,687 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:04:34,741 - INFO - Логи старше 10 минут и строки с неправильным форматом удалены из файла video_service.log.
2025-03-11 19:04:35,086 - INFO - Успешно обработано и закэшировано 914 профилей в Redis.
2025-03-11 19:04:35,152 - INFO - Всего публичных профилей в кеше: 492
2025-03-11 19:04:35,152 - INFO - Собрано уникальных профилей по алгоритму: 41
2025-03-11 19:04:35,153 - INFO - Добавляем 9 случайных профилей из оставшихся.
2025-03-11 19:04:35,153 - INFO - Сформировано страниц: 10
2025-03-11 19:04:35,155 - INFO - В кэше размещено 10 страниц.
2025-03-11 19:04:35,155 - INFO - Сформировано и закэшировано 10 страниц из 492 профилей.
2025-03-11 19:04:35,155 - INFO - Закрытие сессии с БД.
2025-03-11 19:05:19,665 - INFO - Открытие сессии с БД...
2025-03-11 19:05:19,669 - INFO - Сессия с БД успешно открыта.
2025-03-11 19:05:19,986 - INFO - Успешно обработано и закэшировано 914 профилей в Redis.
2025-03-11 19:05:20,048 - INFO - Всего публичных профилей в кеше: 492
2025-03-11 19:05:20,048 - INFO - Собрано уникальных профилей по алгоритму: 41
2025-03-11 19:05:20,049 - INFO - Добавляем 9 случайных профилей из оставшихся.
2025-03-11 19:05:20,049 - INFO - Сформировано страниц: 10
2025-03-11 19:05:20,051 - INFO - В кэше размещено 10 страниц.
2025-03-11 19:05:20,051 - INFO - Сформировано и закэшировано 10 страниц из 492 профилей.
2025-03-11 19:05:20,051 - INFO - Закрытие сессии с БД.
2025-03-11 19:05:20,054 - INFO - Запрошена страница 1. Всего профилей: 492, всего страниц: 10.
2025-03-11 19:05:20,055 - INFO - Показана страница 1 из 10. Профили: 50.
2025-03-11 19:05:55,305 - ERROR - Ошибка при получении сообщения: Connection closed by server.
Module: __main__, Function: main, Line: 168
