2025-03-31 13:04:48,722 - INFO - Запуск подписки на канал Redis для получения задач
2025-03-31 13:04:48,743 - INFO - Redis доступен.
2025-03-31 13:04:48,744 - INFO - Проверка соединения с AWS S3...
2025-03-31 13:04:48,982 - INFO - Запуск приложения и инициализация базы данных...
2025-03-31 13:04:48,982 - DEBUG - Начало инициализации базы данных...
2025-03-31 13:04:49,050 - INFO - База данных успешно инициализирована.
2025-03-31 13:04:49,050 - INFO - Приложение успешно запущено. Соединение с базой данных установлено.
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./video_temp
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./image_temp
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./output_video
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./output_preview
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./user_logo
2025-03-31 13:04:49,050 - INFO - Директория уже существует: ./user_video_posters
2025-03-31 13:04:49,052 - INFO - Задача fetch_and_cache_profiles добавлена в расписание (каждые 8 минут).
2025-03-31 13:04:49,052 - INFO - Задача sync_data_to_db добавлена в расписание (каждые 8 минут).
2025-03-31 13:04:49,052 - INFO - Задача очистки временных файлов добавлена в расписание (каждый день в 00:00).
2025-03-31 13:04:49,052 - INFO - Планировщик задач успешно запущен.
2025-03-31 13:04:49,571 - INFO - Соединение с AWS S3 установлено успешно.
2025-03-31 13:04:49,572 - INFO - Соединение с AWS S3 установлено успешно.
2025-03-31 13:04:49,573 - INFO - Подключаемся к Redis...
2025-03-31 13:04:49,573 - INFO - Подписались на канал video_tasks
2025-03-31 13:05:09,669 - INFO - Открытие сессии с БД...
2025-03-31 13:05:09,675 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:05:09,711 - INFO - Поиск пользователя в базе данных.
2025-03-31 13:05:09,814 - INFO - Пользователь найден с ID 4
2025-03-31 13:05:09,951 - INFO - Получение избранного через get_favorites_from_cache.
2025-03-31 13:05:09,951 - INFO - Попытка получить избранное из кэша Redis для пользователя 4.
2025-03-31 13:05:09,973 - INFO - Избранное не найдено в кэше для пользователя 4. Загружаем из базы данных.
2025-03-31 13:05:09,973 - INFO - Открытие сессии с БД...
2025-03-31 13:05:09,974 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:05:10,038 - INFO - У пользователя 4 нет избранных профилей.
2025-03-31 13:05:10,038 - INFO - Закрытие сессии с БД.
2025-03-31 13:05:10,039 - INFO - Избранное получено: []
2025-03-31 13:05:10,039 - INFO - Генерация токенов для пользователя.
2025-03-31 13:05:10,040 - INFO - Токены успешно сгенерированы.
2025-03-31 13:05:10,040 - INFO - Закрытие сессии с БД.
2025-03-31 13:05:31,037 - INFO - Получен запрос на загрузку изображения от пользователя с ID: 4
2025-03-31 13:05:31,120 - INFO - Изображение сохранено во временной директории: ./image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png (Размер: 0.09 MB)
2025-03-31 13:05:31,120 - INFO - Изображение успешно загружено: ./image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png
2025-03-31 13:06:01,530 - INFO - Получены данные профиля: {'name': 'Ебись все в рот!!!', 'website_or_social': 'https://twitter.com/johndoe', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': ['#gaming', '#travel', '#photography'], 'adress': ['123 Example Street, Example City', '456 Another Street, Another City'], 'city': 'нахуй все', 'coordinates': [(59.77, 37.68)], 'is_in_mlm': 1, 'is_incognito': False, 'wallet_number': '0x39b0B8cfa77fA65f36Ad653F649D36EBC7d4545', 'language': None}
2025-03-31 13:06:01,537 - INFO - Получены данные о изображении: {'image_path': './image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png'}
2025-03-31 13:06:01,592 - INFO - Путь к изображению: ./image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png
2025-03-31 13:06:01,593 - INFO - Абсолютный путь к изображению: /app/image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png
2025-03-31 13:06:01,610 - INFO - Изображение перемещено в директорию user_logo: ./user_logo/d65d12c6-ad3f-4e97-b99c-c478c23cc178_37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png (Размер: 0.09 MB)
2025-03-31 13:06:01,610 - INFO - Путь к файлу для сохранения в БД: ./user_logo/d65d12c6-ad3f-4e97-b99c-c478c23cc178_37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png
2025-03-31 13:06:01,610 - INFO - Изображение успешно перемещено в постоянную папку: ./user_logo/d65d12c6-ad3f-4e97-b99c-c478c23cc178_37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png
2025-03-31 13:06:01,611 - INFO - Открытие сессии с БД...
2025-03-31 13:06:01,613 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:06:01,758 - INFO - Создан профиль для пользователя 4 с user_link: https://sttore.link/c3in-ijap-hztu-w2fh
2025-03-31 13:06:01,779 - INFO - Хэштеги обработаны для профиля 0x39b0B8cfa77fA65f36Ad653F649D36EBC7d4545
2025-03-31 13:06:01,786 - INFO - Профиль успешно сохранен.
2025-03-31 13:06:01,786 - INFO - Закрытие сессии с БД.
2025-03-31 13:06:56,676 - INFO - Получены данные профиля: {'name': 'John Doe', 'website_or_social': 'https://twitter.com/johndoe', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': ['#travel', '#photography'], 'adress': ['123 Example Street, Example City', '456 Another Street, Another City'], 'city': 'Example City', 'coordinates': [(37.7749, -122.4194), (48.8566, 2.3522)], 'is_in_mlm': 1, 'is_incognito': False, 'wallet_number': '0x123abc456def', 'language': 'English'}
2025-03-31 13:06:56,678 - INFO - Получены данные о изображении: {}
2025-03-31 13:06:56,680 - INFO - Открытие сессии с БД...
2025-03-31 13:06:56,681 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:06:56,697 - ERROR - Пользователь с данным кошельком не найден.
Module: cashe, Function: save_profile_to_db_without_video, Line: 697
2025-03-31 13:06:56,699 - ERROR - Непредвиденная ошибка: 400: Пользователь с данным кошельком не найден.
Module: cashe, Function: save_profile_to_db_without_video, Line: 843
2025-03-31 13:06:56,701 - ERROR - Ошибка в контексте сессии: 500: Непредвиденная ошибка. Попробуйте позже.
Module: database, Function: get_db_session_for_worker, Line: 71
2025-03-31 13:06:56,701 - INFO - Закрытие сессии с БД.
2025-03-31 13:06:56,702 - ERROR - Ошибка в функции save_profile_to_db_without_video: 500: Непредвиденная ошибка. Попробуйте позже.
Module: cashe, Function: save_profile_to_db_without_video, Line: 851
2025-03-31 13:06:56,702 - ERROR - Ошибка в эндпоинте /save_profile_without_video/: 500: Непредвиденная ошибка. Попробуйте позже.
Module: main, Function: create_or_update_user_profile, Line: 587
2025-03-31 13:07:49,068 - INFO - Открытие сессии с БД...
2025-03-31 13:07:49,071 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:07:49,081 - INFO - Закрытие сессии с БД.
2025-03-31 13:07:49,081 - INFO - Данные о избранном и счетчике подписчиков успешно синхронизированы из кеша в базу данных для всех пользователей.
2025-03-31 13:08:09,141 - INFO - Открытие сессии с БД...
2025-03-31 13:08:09,145 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:08:09,152 - INFO - Поиск пользователя в базе данных.
2025-03-31 13:08:09,165 - INFO - Пользователь найден с ID 4
2025-03-31 13:08:09,187 - INFO - Получение избранного через get_favorites_from_cache.
2025-03-31 13:08:09,187 - INFO - Попытка получить избранное из кэша Redis для пользователя 4.
2025-03-31 13:08:09,190 - INFO - Избранное не найдено в кэше для пользователя 4. Загружаем из базы данных.
2025-03-31 13:08:09,190 - INFO - Открытие сессии с БД...
2025-03-31 13:08:09,191 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:08:09,198 - INFO - У пользователя 4 нет избранных профилей.
2025-03-31 13:08:09,199 - INFO - Закрытие сессии с БД.
2025-03-31 13:08:09,201 - INFO - Избранное получено: []
2025-03-31 13:08:09,202 - INFO - Генерация токенов для пользователя.
2025-03-31 13:08:09,209 - INFO - Токены успешно сгенерированы.
2025-03-31 13:08:09,211 - INFO - Закрытие сессии с БД.
2025-03-31 13:08:56,720 - INFO - Получены данные профиля: {'name': 'Ебись все в рот!!!', 'website_or_social': 'https://twitter.com/johndoe', 'activity_hobbies': 'Gaming, Traveling', 'hashtags': ['#travel', '#photography'], 'adress': ['123 Example Street, Example City', '456 Another Street, Another City'], 'city': 'нахуй все', 'coordinates': [(59.77, 37.68)], 'is_in_mlm': 1, 'is_incognito': False, 'wallet_number': '0x39b0B8cfa77fA65f36Ad653F649D36EBC7d4545', 'language': None}
2025-03-31 13:08:56,722 - INFO - Получены данные о изображении: {'image_path': './image_temp/37d0916f-1b33-4869-8c2e-d8228d25c52b_молекула_preview_rev_1.png'}
2025-03-31 13:08:56,725 - INFO - Открытие сессии с БД...
2025-03-31 13:08:56,725 - INFO - Сессия с БД успешно открыта.
2025-03-31 13:08:56,741 - INFO - Обновлен профиль пользователя 4, user_link сохранен: https://sttore.link/c3in-ijap-hztu-w2fh
2025-03-31 13:08:56,784 - INFO - Хэштеги обработаны для профиля 0x39b0B8cfa77fA65f36Ad653F649D36EBC7d4545
2025-03-31 13:08:56,792 - INFO - Профиль успешно обновлен.
2025-03-31 13:08:56,795 - INFO - Закрытие сессии с БД.
2025-03-31 13:09:05,662 - ERROR - Ошибка при получении сообщения: Connection closed by server.
Module: __main__, Function: main, Line: 181
